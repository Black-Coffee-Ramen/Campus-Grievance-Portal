<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lo-Fi - Campus Grievance Portal</title>
    <style>
        :root {
            --border-color: #ccc;
            --background-color: #f5f5f5;
            --text-color: #333;
            --text-muted-color: #777;
            --button-bg: #e0e0e0;
            --button-hover-bg: #d5d5d5;
            --button-primary-bg: #444;
            --button-primary-hover-bg: #333;
        }
        body {
            font-family: Arial, sans-serif;
            color: var(--text-color);
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem;
            min-height: 100vh;
            margin: 0;
        }
        .prototype-container {
            width: 100%;
            max-width: 1200px;
            background-color: #fff;
            border: 1px solid var(--border-color);
        }
        .screen-header {
            padding: 1rem 1.5rem;
            background-color: var(--background-color);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 1.2rem;
            text-align: center;
        }
        .screen-content { padding: 2rem; }
        .screen { display: none; }
        .screen.active { display: block; }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            margin: 0.5rem 0 1rem 0;
            border: 1px solid var(--border-color);
            background-color: #fff;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 1rem;
        }
        input:focus, textarea:focus, select:focus {
            outline: 1px solid var(--text-color);
        }
        .lofi-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-color);
            background-color: var(--button-bg);
            color: var(--text-color);
            cursor: pointer;
            text-align: center;
            margin-right: 1rem;
            margin-top: 1rem;
            font-weight: 600;
            box-sizing: border-box;
        }
        .lofi-button:hover { background-color: var(--button-hover-bg); }
        .lofi-button.primary {
            background-color: var(--button-primary-bg);
            color: #fff;
        }
        .lofi-button.primary:hover { background-color: var(--button-primary-hover-bg); }
        .lofi-button.full-width { width: 100%; display: block; }
        .lofi-link { cursor: pointer; text-decoration: underline; color: #333; }
        .lofi-label { display: block; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.25rem; }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .lofi-card {
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .lofi-card.clickable:hover { background-color: var(--background-color); cursor: pointer; }
        .lofi-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        .lofi-status {
            padding: 0.25rem 0.75rem;
            font-size: 0.8em;
            font-weight: bold;
            background-color: #eee;
            border: 1px solid #ddd;
            white-space: nowrap;
        }
        
        .lofi-table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        .lofi-table th, .lofi-table td { border: 1px solid var(--border-color); padding: 1rem; text-align: left; }
        .lofi-table th { background-color: var(--background-color); }
        .lofi-table tr:hover { background-color: var(--background-color); }
        .lofi-table td small { color: var(--text-muted-color); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #fff; padding: 2rem; border: 1px solid #333; width: 90%; max-width: 600px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem;}
        .modal-close { font-size: 1.5rem; cursor: pointer; border: none; background: none; color: #888; }
    </style>
</head>
<body>

    <div class="prototype-container">

        <div id="login-screen" class="screen active">
             <div class="screen-header">Grievance Portal</div>
             <div class="screen-content" style="max-width: 400px; margin: 2rem auto;">
                <h2 style="text-align:center;">Login</h2>
                <label class="lofi-label" for="login-id">Your ID</label>
                <input type="text" id="login-id">
                <label class="lofi-label" for="login-pass">Password</label>
                <input type="password" id="login-pass">
                <div class="lofi-button primary full-width" onclick="login('student')">Login (Student)</div>
                <div class="lofi-button full-width" onclick="login('admin')">Login (Admin)</div>
            </div>
        </div>

        <div id="student-dashboard-screen" class="screen">
            <div class="screen-header">Dashboard</div>
            <div class="screen-content">
                <div class="dashboard-header">
                    <h2 id="student-welcome-message"></h2>
                    <span class="lofi-link" onclick="logout()">Logout</span>
                </div>
                <div class="lofi-button primary" onclick="navigateTo('submit-form-screen')">+ New Grievance</div>
                <h3 style="margin-top: 2.5rem;">Active Grievances</h3>
                <div id="student-active-grievances"></div>
                <h3 style="margin-top: 2.5rem;">Resolved Grievances</h3>
                <div id="student-resolved-grievances"></div>
            </div>
        </div>
        
        <div id="submit-form-screen" class="screen">
            <div class="screen-header">New Grievance Form</div>
            <div class="screen-content">
                <label class="lofi-label" for="category">Category</label>
                <select id="category">
                    <option value="">Select a category...</option>
                    <option value="Academic">Academic</option>
                    <option value="Administrative">Administrative</option>
                    <option value="Facilities">Facilities</option>
                    <option value="Hostel">Hostel</option>
                    <option value="Other">Other</option>
                </select>
                <label class="lofi-label" for="title">Title</label>
                <input type="text" id="title" placeholder="e.g., Broken chair in library">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label class="lofi-label" for="description">Description</label>
                    <div class="lofi-button" style="margin-top:0; background: #f0f0f0; cursor: not-allowed; color: #999;">âœ¨ AI Help</div>
                </div>
                <textarea id="description" rows="5" placeholder="Describe your issue in detail..."></textarea>
                <div style="margin: 1rem 0; display:flex; align-items:center;">
                    <input type="checkbox" id="anonymous-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <label for="anonymous-checkbox" style="font-weight:normal; margin:0;">Submit Anonymously</label>
                </div>
                <div class="lofi-button primary" onclick="submitNewGrievance()">Submit</div>
                <div class="lofi-button" onclick="goBackToDashboard()">Cancel</div>
            </div>
        </div>

        <div id="confirmation-screen" class="screen">
            <div class="screen-header">Success</div>
            <div class="screen-content" style="text-align: center; padding: 4rem 2rem;">
                <h2>Grievance Submitted!</h2>
                <p>Your ticket number is: <strong id="new-grievance-id" style="font-size:1.5rem; background:#eee; padding: 0.5rem 1rem;"></strong></p>
                <div class="lofi-button primary" onclick="navigateTo('student-dashboard-screen')">Back to Dashboard</div>
            </div>
        </div>

        <div id="tracking-screen" class="screen">
             <div class="screen-header">Track Grievance</div>
             <div class="screen-content">
                <div class="dashboard-header">
                    <h2 id="tracking-id-header"></h2>
                    <div class="lofi-button" onclick="goBackToDashboard()">Back</div>
                </div>
                <div class="lofi-card">
                    <p><strong>Title:</strong> <span id="tracking-title"></span></p>
                    <p><strong>Status:</strong> <span id="tracking-status" class="lofi-status"></span></p>
                    <p><strong>Submitted:</strong> <span id="tracking-date"></span></p>
                    <strong>Description:</strong>
                    <p id="tracking-description" style="margin-top:0.5rem;"></p>
                </div>
            </div>
        </div>

        <div id="admin-dashboard-screen" class="screen">
            <div class="screen-header">Admin Dashboard</div>
            <div class="screen-content">
                 <div class="dashboard-header">
                    <h2>All Grievances</h2>
                    <span class="lofi-link" onclick="logout()">Logout</span>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <strong>Filters:</strong>
                    <select disabled><option>Status: All</option></select>
                    <select disabled><option>Category: All</option></select>
                </div>
                <table class="lofi-table">
                    <thead><tr><th>ID</th><th>Title</th><th>Submitter</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="admin-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="admin-details-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-grievance-id"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let lastTicketId = 12347;
        let grievances = [
            { id: 12345, title: 'Incorrect Grade in Physics', category: 'Academic', submittedBy: '10210456', submitterName: 'Jane Doe', email: 'jane.doe@example.com', description: 'My final grade was calculated incorrectly.', date: '2025-09-12', status: 'In Review'},
            { id: 12344, title: 'Faulty Wi-Fi in Library', category: 'Facilities', submittedBy: '20310222', submitterName: 'Mark Smith', email: 'mark.smith@example.com', description: 'Wi-Fi is unstable on the 3rd floor.', date: '2025-09-10', status: 'New'},
            { id: 12346, title: 'Hostel Room Change Request', category: 'Hostel', submittedBy: '10210456', submitterName: 'Jane Doe', email: 'jane.doe@example.com', description: 'Requesting a room change.', date: '2025-09-01', status: 'Resolved'},
            { id: 12347, title: 'Misconduct during lecture', category: 'Academic', submittedBy: 'Anonymous', submitterName: 'Anonymous', email: null, description: 'A professor made inappropriate comments.', date: '2025-09-09', status: 'New'}
        ];

        function login(role) {
            if (role === 'student') {
                currentUser = { id: '10210456', name: 'Jane Doe', role: 'student', email: 'jane.doe@example.com' };
                navigateTo('student-dashboard-screen');
            } else {
                currentUser = { id: 'admin01', name: 'Admin', role: 'admin' };
                navigateTo('admin-dashboard-screen');
            }
        }
        function logout() { currentUser = null; navigateTo('login-screen'); }

        function navigateTo(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            if (currentUser) {
                if (screenId === 'student-dashboard-screen') renderStudentDashboard();
                if (screenId === 'admin-dashboard-screen') renderAdminTable(grievances);
            }
        }

        function goBackToDashboard() {
            navigateTo(currentUser.role === 'admin' ? 'admin-dashboard-screen' : 'student-dashboard-screen');
        }
        
        function renderStudentDashboard() {
            document.getElementById('student-welcome-message').textContent = `Welcome, ${currentUser.name}`;
            const userGrievances = grievances.filter(g => g.submittedBy === currentUser.id);
            const activeContainer = document.getElementById('student-active-grievances');
            const resolvedContainer = document.getElementById('student-resolved-grievances');
            activeContainer.innerHTML = ''; resolvedContainer.innerHTML = '';
            
            const active = userGrievances.filter(g => g.status !== 'Resolved');
            const resolved = userGrievances.filter(g => g.status === 'Resolved');

            if(active.length) active.forEach(g => activeContainer.appendChild(createGrievanceCard(g)));
            else activeContainer.innerHTML = `<p style="color: var(--text-muted-color);">No active grievances.</p>`;
            
            if(resolved.length) resolved.forEach(g => resolvedContainer.appendChild(createGrievanceCard(g)));
             else resolvedContainer.innerHTML = `<p style="color: var(--text-muted-color);">No resolved grievances.</p>`;
        }

        function createGrievanceCard(g) {
            const card = document.createElement('div');
            card.className = 'lofi-card clickable';
            card.onclick = () => navigateToTrackingPage(g.id);
            card.innerHTML = `<div class="lofi-card-header"><span>${g.title}</span><span class="lofi-status">${g.status}</span></div><div>ID: ${g.id} | Submitted: ${g.date}</div>`;
            return card;
        }
        
        function submitNewGrievance() {
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const isAnonymous = document.getElementById('anonymous-checkbox').checked;

            if (!title || !description) { alert('Title and Description are required.'); return; }
            
            lastTicketId++;
            const newGrievance = {
                id: lastTicketId,
                title, description,
                category: document.getElementById('category').value,
                submittedBy: isAnonymous ? 'Anonymous' : currentUser.id,
                submitterName: isAnonymous ? 'Anonymous' : currentUser.name,
                email: isAnonymous ? null : currentUser.email,
                date: new Date().toISOString().split('T')[0],
                status: 'New'
            };
            grievances.unshift(newGrievance);
            
            document.getElementById('new-grievance-id').textContent = newGrievance.id;
            navigateTo('confirmation-screen');
        }

        function navigateToTrackingPage(id) {
            const g = grievances.find(item => item.id === id);
            if (!g) return;
            
            document.getElementById('tracking-id-header').textContent = `Ticket #${g.id}`;
            document.getElementById('tracking-title').textContent = g.title;
            document.getElementById('tracking-date').textContent = g.date;
            document.getElementById('tracking-description').textContent = g.description;
            document.getElementById('tracking-status').textContent = g.status;
            navigateTo('tracking-screen');
        }

        function renderAdminTable(data) {
            const tableBody = document.getElementById('admin-table-body');
            tableBody.innerHTML = '';
            const sortedData = [...data].sort((a,b) => b.id - a.id);
            sortedData.forEach(g => {
                const row = tableBody.insertRow();
                const submitterInfo = g.submitterName === 'Anonymous' ? 'Anonymous' : `${g.submitterName}<br><small style="color:var(--text-muted-color);">${g.email}</small>`;
                row.innerHTML = `
                    <td>${g.id}</td><td>${g.title}</td><td>${submitterInfo}</td>
                    <td>${g.date}</td><td><span class="lofi-status">${g.status}</span></td>
                    <td><div class="lofi-link" onclick="viewGrievanceDetails(${g.id})">View / Action</div></td>`;
            });
        }

        function updateGrievanceStatus(id, newStatus) {
            const g = grievances.find(item => item.id === id);
            if (g) g.status = newStatus;
            closeModal();
            renderAdminTable(grievances);
        }
        
        function viewGrievanceDetails(id) {
            const g = grievances.find(item => item.id === id);
            document.getElementById('modal-grievance-id').textContent = `Ticket #${id}`;
            const body = document.getElementById('modal-body');
            const submitterInfo = g.submitterName === 'Anonymous' ? 'Anonymous' : `${g.submitterName} (${g.email})`;
            body.innerHTML = `
                <p><strong>From:</strong> ${submitterInfo}</p>
                <p><strong>Title:</strong> ${g.title}</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; margin-bottom: 0.5rem;">
                    <h4 style="margin:0;">Description</h4>
                    <div class="lofi-button" style="margin-top:0; cursor: not-allowed; background: #f0f0f0; color: #999;">âœ¨ Generate Summary</div>
                </div>
                <div class="lofi-card" style="margin-top:0;">${g.description}</div>
                <h4 style="margin-top:1.5rem;">Actions</h4>
                <div style="display:flex; flex-wrap:wrap; gap:0.5rem;">
                    <div class="lofi-button" onclick="updateGrievanceStatus(${id}, 'In Review')">Mark as In Review</div>
                    <div class="lofi-button primary" onclick="updateGrievanceStatus(${id}, 'Resolved')">Mark as Resolved</div>
                </div>`;
            document.getElementById('admin-details-modal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('admin-details-modal').style.display = 'none'; }

        document.addEventListener('DOMContentLoaded', () => navigateTo('login-screen'));
    </script>
</body>
</html>

